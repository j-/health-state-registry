"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _Registry=require("../Registry");var _Registry2=_interopRequireDefault(_Registry);var _errorsNotImplementedError=require("../errors/NotImplementedError");var _errorsNotImplementedError2=_interopRequireDefault(_errorsNotImplementedError);var Adapter=function(){function Adapter(){_classCallCheck(this,Adapter)}_createClass(Adapter,[{key:"createSystem",value:function createSystem(system){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return Promise.reject(new _errorsNotImplementedError2["default"]("`createSystem` must be implemented by subclass"))}},{key:"getSystem",value:function getSystem(id){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return Promise.reject(new _errorsNotImplementedError2["default"]("`getSystem` must be implemented by subclass"))}},{key:"updateSystem",value:function updateSystem(id,system){var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];return Promise.reject(new _errorsNotImplementedError2["default"]("`updateSystem` must be implemented by subclass"))}},{key:"deleteSystem",value:function deleteSystem(id){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return Promise.reject(new _errorsNotImplementedError2["default"]("`deleteSystem` must be implemented by subclass"))}},{key:"getNextId",value:function getNextId(){return Promise.resolve(Math.random().toString())}},{key:"assignSystemId",value:function assignSystemId(id,system){system[_Registry2["default"].identifier]=id}},{key:"getSystemId",value:function getSystemId(system){return system[_Registry2["default"].identifier]||null}},{key:"prepareSystem",value:function prepareSystem(_ref){var _ref$name=_ref.name;var name=_ref$name===undefined?null:_ref$name;var _ref$lastPing=_ref.lastPing;var lastPing=_ref$lastPing===undefined?null:_ref$lastPing;return{name:name,lastPing:lastPing}}}]);return Adapter}();exports["default"]=Adapter;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;desc=parent=getter=undefined;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _Adapter2=require("./Adapter");var _Adapter3=_interopRequireDefault(_Adapter2);var _errorsNotFoundError=require("../errors/NotFoundError");var _errorsNotFoundError2=_interopRequireDefault(_errorsNotFoundError);var SYSTEMS=Symbol("systems");var VolatileAdapter=function(_Adapter){_inherits(VolatileAdapter,_Adapter);function VolatileAdapter(){_classCallCheck(this,VolatileAdapter);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_get(Object.getPrototypeOf(VolatileAdapter.prototype),"constructor",this).apply(this,args);this[SYSTEMS]=new Map}_createClass(VolatileAdapter,[{key:"createSystem",value:function createSystem(options){var _this=this;var system=this.prepareSystem(options);return this.getNextId().then(function(id){_this.assignSystemId(id,system);_this[SYSTEMS].set(id,system);return system})}},{key:"getSystem",value:function getSystem(id){var system=this[SYSTEMS].get(id);if(!system){return Promise.reject(new _errorsNotFoundError2["default"]('Could not find system with id "'+id+'"'))}return Promise.resolve(system)}},{key:"updateSystem",value:function updateSystem(id,properties,options){return this.getSystem(id).then(function(system){Object.assign(system,properties);return system})}}]);return VolatileAdapter}(_Adapter3["default"]);exports["default"]=VolatileAdapter;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;desc=parent=getter=undefined;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CustomError=function(_Error){_inherits(CustomError,_Error);function CustomError(message){_classCallCheck(this,CustomError);_get(Object.getPrototypeOf(CustomError.prototype),"constructor",this).call(this);this.message=message;this.stack=(new Error).stack}_createClass(CustomError,[{key:"name",get:function get(){return this.constructor.name}}]);return CustomError}(Error);exports["default"]=CustomError;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(_x2,_x3,_x4){var _again=true;_function:while(_again){var object=_x2,property=_x3,receiver=_x4;desc=parent=getter=undefined;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x2=parent;_x3=property;_x4=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _CustomError2=require("./CustomError");var _CustomError3=_interopRequireDefault(_CustomError2);var DEFAULT_MESSAGE="The requested resource could not be found";var NotFoundError=function(_CustomError){_inherits(NotFoundError,_CustomError);function NotFoundError(){var message=arguments.length<=0||arguments[0]===undefined?DEFAULT_MESSAGE:arguments[0];_classCallCheck(this,NotFoundError);_get(Object.getPrototypeOf(NotFoundError.prototype),"constructor",this).call(this,message)}return NotFoundError}(_CustomError3["default"]);exports["default"]=NotFoundError;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(_x2,_x3,_x4){var _again=true;_function:while(_again){var object=_x2,property=_x3,receiver=_x4;desc=parent=getter=undefined;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x2=parent;_x3=property;_x4=receiver;_again=true;continue _function}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _CustomError2=require("./CustomError");var _CustomError3=_interopRequireDefault(_CustomError2);var DEFAULT_MESSAGE="Must be implemented by subclass";var NotImplementedError=function(_CustomError){_inherits(NotImplementedError,_CustomError);function NotImplementedError(){var message=arguments.length<=0||arguments[0]===undefined?DEFAULT_MESSAGE:arguments[0];_classCallCheck(this,NotImplementedError);_get(Object.getPrototypeOf(NotImplementedError.prototype),"constructor",this).call(this,message)}return NotImplementedError}(_CustomError3["default"]);exports["default"]=NotImplementedError;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Registry=function(){function Registry(_ref){var adapter=_ref.adapter;_classCallCheck(this,Registry);this.adapter=adapter}_createClass(Registry,[{key:"createSystem",value:function createSystem(){var _adapter;return(_adapter=this.adapter).createSystem.apply(_adapter,arguments)}},{key:"getSystem",value:function getSystem(){var _adapter2;return(_adapter2=this.adapter).getSystem.apply(_adapter2,arguments)}},{key:"updateSystem",value:function updateSystem(){var _adapter3;return(_adapter3=this.adapter).updateSystem.apply(_adapter3,arguments)}},{key:"deleteSystem",value:function deleteSystem(){var _adapter4;return(_adapter4=this.adapter).deleteSystem.apply(_adapter4,arguments)}}]);return Registry}();exports["default"]=Registry;Registry.identifier=Symbol("identifier");module.exports=exports["default"];